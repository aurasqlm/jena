<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YT Chat Hacker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top left, #1a1a2e, #16213e, #0f3460);
            height: 100dvh;
            overflow: hidden;
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-container::-webkit-scrollbar {
            width: 4px;
        }
        .chat-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading-dots { animation: pulse-soft 1.5s infinite; }
    </style>
</head>
<body class="text-gray-100 flex flex-col">

    <header class="p-4 flex justify-between items-center glass z-20">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 bg-red-500 rounded-full shadow-[0_0_10px_#ef4444]"></div>
            <h1 class="font-bold text-lg tracking-tight">YT_HACKER <span class="text-xs font-mono text-gray-400">v1.0</span></h1>
        </div>
        <button onclick="toggleModal('settingsModal')" class="p-2 hover:bg-white/10 rounded-full transition-all">
            <i class="fa-solid fa-gear text-xl text-gray-300"></i>
        </button>
    </header>

    <div class="p-4 space-y-3 z-10">
        <div class="relative group">
            <input type="text" id="ytUrl" placeholder="Paste YouTube URL..." 
                class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 pr-12 focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all placeholder:text-gray-500">
            <button onclick="loadVideo()" class="absolute right-2 top-1.5 bg-blue-600 hover:bg-blue-500 p-2 rounded-lg transition-colors">
                <i class="fa-solid fa-bolt"></i>
            </button>
        </div>
        <div id="statusBadge" class="hidden flex items-center gap-2 text-xs font-mono bg-green-500/10 text-green-400 p-2 rounded-lg border border-green-500/20">
            <i class="fa-solid fa-check-double"></i> CONTEXT LOADED
        </div>
    </div>

    <main id="chatArea" class="flex-1 overflow-y-auto p-4 space-y-4 chat-container">
        <div class="glass p-3 rounded-2xl max-w-[85%] text-sm leading-relaxed">
            Welcome, Aurasqlm. Paste a YouTube URL above and hit the bolt to "hack" the transcript. Then ask me anything about it.
        </div>
    </main>

    <div id="loader" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center">
        <div class="flex flex-col items-center gap-3">
            <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="text-sm font-mono text-blue-400 loading-dots">BYPASSING_RESTRICTIONS...</p>
        </div>
    </div>

    <footer class="p-4 pb-8 glass">
        <div class="flex gap-2">
            <textarea id="userInput" rows="1" placeholder="Ask about the video..." 
                class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 resize-none"></textarea>
            <button onclick="sendMessage()" class="bg-blue-600 hover:bg-blue-500 px-5 rounded-xl transition-all">
                <i class="fa-solid fa-paper-plane"></i>
            </button>
        </div>
    </footer>

    <div id="settingsModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/80 backdrop-blur-md">
        <div class="glass w-full max-w-sm rounded-3xl p-6 space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-bold">Terminal Config</h2>
                <button onclick="toggleModal('settingsModal')" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            
            <div class="space-y-4">
                <div class="space-y-2">
                    <label class="text-xs font-mono text-gray-400 uppercase">OpenRouter API Key</label>
                    <input type="password" id="apiKey" placeholder="sk-or-..." 
                        class="w-full bg-black/40 border border-white/10 rounded-lg px-4 py-2 focus:ring-1 focus:ring-blue-500 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-xs font-mono text-gray-400 uppercase">Model Identifier</label>
                    <input type="text" id="modelName" placeholder="e.g. google/gemini-2.0-flash-lite:free" 
                        class="w-full bg-black/40 border border-white/10 rounded-lg px-4 py-2 focus:ring-1 focus:ring-blue-500 outline-none">
                </div>
            </div>

            <button onclick="saveSettings()" class="w-full bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200 transition-colors">
                SAVE CONFIG
            </button>
        </div>
    </div>

    <script>
        let videoContext = "";

        // Persistence Logic
        window.onload = () => {
            document.getElementById('apiKey').value = localStorage.getItem('or_api_key') || '';
            document.getElementById('modelName').value = localStorage.getItem('or_model_name') || 'google/gemini-2.0-flash-lite:free';
        };

        function saveSettings() {
            localStorage.setItem('or_api_key', document.getElementById('apiKey').value);
            localStorage.setItem('or_model_name', document.getElementById('modelName').value);
            toggleModal('settingsModal');
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            m.classList.toggle('hidden');
        }

        function showLoader(show) {
            document.getElementById('loader').classList.toggle('hidden', !show);
        }

        async function loadVideo() {
            const url = document.getElementById('ytUrl').value;
            if (!url) return alert("Paste a URL first!");

            showLoader(true);
            try {
                // Jina Reader Magic: returns markdown text of the page/video
                const response = await fetch(`https://r.jina.ai/${url}`);
                const text = await response.text();
                
                videoContext = text;
                document.getElementById('statusBadge').classList.remove('hidden');
                addMessage("System", "Video content successfully indexed. Ready for interrogation.");
            } catch (err) {
                alert("Failed to fetch transcript. Jina might be rate-limited or the URL is invalid.");
            } finally {
                showLoader(false);
            }
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const query = input.value.trim();
            const apiKey = localStorage.getItem('or_api_key');
            const model = localStorage.getItem('or_model_name');

            if (!query) return;
            if (!apiKey) return toggleModal('settingsModal');
            if (!videoContext) return alert("Load a video first to provide context!");

            addMessage("User", query);
            input.value = "";
            showLoader(true);

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${apiKey}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": model,
                        "messages": [
                            { "role": "system", "content": `You are a helpful assistant analyzing a YouTube video. Context: ${videoContext}` },
                            { "role": "user", "content": query }
                        ]
                    })
                });

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                addMessage("AI", aiResponse);
            } catch (err) {
                addMessage("System", "Error: Connection to OpenRouter failed.");
            } finally {
                showLoader(false);
            }
        }

        function addMessage(sender, text) {
            const chatArea = document.getElementById('chatArea');
            const msgDiv = document.createElement('div');
            const isUser = sender === "User";
            
            msgDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
            msgDiv.innerHTML = `
                <div class="${isUser ? 'bg-blue-600' : 'glass'} p-3 rounded-2xl max-w-[85%] text-sm leading-relaxed shadow-lg">
                    ${text.replace(/\n/g, '<br>')}
                </div>
            `;
            
            chatArea.appendChild(msgDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // Handle enter key
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html>
